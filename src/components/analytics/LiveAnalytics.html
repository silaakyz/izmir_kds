<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Analytics</title>
<style>
  body { font-family: sans-serif; background-color: #f0f4f8; margin: 20px; color: #333; }
  .glass-card { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-radius: 12px; border: 1px solid rgba(200,200,200,0.4); padding: 20px; margin-bottom: 20px; }
  .flex { display: flex; }
  .items-center { align-items: center; }
  .justify-between { justify-content: space-between; }
  .gap-2 { gap: 8px; }
  .gap-3 { gap: 12px; }
  .gap-4 { gap: 16px; }
  .gap-6 { gap: 24px; }
  .grid { display: grid; gap: 15px; }
  .grid-cols-5 { grid-template-columns: repeat(5, 1fr); }
  .grid-cols-1 { grid-template-columns: 1fr; }
  .font-bold { font-weight: bold; }
  .font-medium { font-weight: 500; }
  .text-sm { font-size: 0.875rem; }
  .text-muted { color: #666; }
  .badge { background-color: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; }
  select { padding: 4px 6px; border-radius: 6px; border: 1px solid #ccc; }
  canvas { max-width: 100%; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="glass-card">
  <h2 class="font-bold">Veri Analizi</h2>
  <p class="text-muted">Aylık trendler ve yıllık karşılaştırmalar (2023-2025)</p>

  <div class="flex gap-3 flex-wrap" style="margin-top:12px;">
    <select id="viewModeSelect">
      <option value="monthly">Aylık Görünüm</option>
      <option value="quarterly">Çeyreklik Görünüm</option>
    </select>

    <select id="yearSelect" style="display:none;">
      <option value="2023">2023</option>
      <option value="2024">2024</option>
      <option value="2025" selected>2025</option>
    </select>

    <select id="districtSelect">
      <option value="all">Tüm Bölgeler</option>
      <option value="top5" selected>İlk 5 Bölge</option>
    </select>
  </div>
</div>

<div class="glass-card" id="summaryStats">
  <h3 class="font-bold">Özet İstatistikler</h3>
  <div class="grid grid-cols-5 gap-4" id="summaryContainer"></div>
</div>

<div class="glass-card">
  <h3 class="font-bold" id="mainChartTitle">Aylık Trend Analizi (2025)</h3>
  <canvas id="mainChart" height="300"></canvas>
</div>

<div class="glass-card">
  <h3 class="font-bold">2023 - 2024 - 2025 Karşılaştırması</h3>
  <canvas id="yearComparisonChart" height="400"></canvas>
</div>

<script>
  // Örnek veri
  const districts = [
    { id:1, name:"Konak", scores:{overall:8} },
    { id:2, name:"Karşıyaka", scores:{overall:6} },
    { id:3, name:"Bornova", scores:{overall:6} },
    { id:4, name:"Buca", scores:{overall:6} },
    { id:5, name:"Bayraklı", scores:{overall:7} },
    { id:6, name:"Çiğli", scores:{overall:6} }
  ];

  const viewModeSelect = document.getElementById('viewModeSelect');
  const yearSelect = document.getElementById('yearSelect');
  const districtSelect = document.getElementById('districtSelect');
  const mainChartTitle = document.getElementById('mainChartTitle');
  const summaryContainer = document.getElementById('summaryContainer');
  const mainChartCanvas = document.getElementById('mainChart').getContext('2d');
  const yearChartCanvas = document.getElementById('yearComparisonChart').getContext('2d');
  const colors = ['#006064','#00838f','#0097a7','#00acc1','#00bcd4','#26c6da','#4dd0e1','#80deea','#b2ebf2','#e0f7fa'];

  let mainChart, yearChart;

  function generateMonthlyData(selectedDistricts){
    const months = ["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"];
    return months.map((month,index)=>{
      const obj = {month};
      selectedDistricts.forEach(d=>{
        const variation = Math.sin((index/12)*Math.PI*2)*0.5 + (Math.random()-0.5)*0.3;
        obj[d.name] = Math.min(10, Math.max(1, d.scores.overall + variation));
      });
      return obj;
    });
  }

  function generateQuarterlyData(selectedDistricts,year){
    const quarters = [`Q1 ${year}`,`Q2 ${year}`,`Q3 ${year}`,`Q4 ${year}`];
    return quarters.map((q,index)=>{
      const obj = {quarter:q};
      selectedDistricts.forEach(d=>{
        const yearOffset = year==='2023'?-0.6: year==='2024'?-0.3:0;
        const trend = index*0.15;
        const variation = (Math.random()-0.5)*0.4;
        obj[d.name] = Math.min(10, Math.max(1, d.scores.overall+yearOffset+trend+variation));
      });
      return obj;
    });
  }

  function generateYearComparison(selectedDistricts){
    return selectedDistricts.map(d=>{
      const score2023 = Math.min(10, Math.max(1,d.scores.overall-0.8+(Math.random()-0.5)*0.4));
      const score2024 = Math.min(10, Math.max(1,d.scores.overall-0.3+(Math.random()-0.5)*0.3));
      const score2025 = d.scores.overall;
      return {name:d.name,"2023":score2023,"2024":score2024,"2025":score2025};
    });
  }

  function updateDashboard(){
    const viewMode = viewModeSelect.value;
    const year = yearSelect.value;
    const districtOption = districtSelect.value;

    let selectedDistricts = districtOption==='all'? districts : districts.slice(0,5);
    const monthlyData = generateMonthlyData(selectedDistricts);
    const quarterlyData = generateQuarterlyData(selectedDistricts,year);
    const yearComparison = generateYearComparison(selectedDistricts);

    mainChartTitle.innerText = viewMode==='monthly'? "Aylık Trend Analizi (2025)" : `Çeyreklik Performans (${year})`;
    yearSelect.style.display = viewMode==='quarterly'? 'inline':'none';

    // Summary Stats
    summaryContainer.innerHTML = '';
    const avg2025 = yearComparison.reduce((sum,d)=>sum+d["2025"],0)/yearComparison.length;
    const avg2024 = yearComparison.reduce((sum,d)=>sum+d["2024"],0)/yearComparison.length;
    const avg2023 = yearComparison.reduce((sum,d)=>sum+d["2023"],0)/yearComparison.length;
    const yoyChange = ((avg2025-avg2024)/avg2024*100).toFixed(1);

    const stats = [
      {label:"2025 Ortalaması", value:avg2025.toFixed(1)},
      {label:"2024 Ortalaması", value:avg2024.toFixed(1)},
      {label:"2023 Ortalaması", value:avg2023.toFixed(1)},
      {label:"Yıllık Değişim", value:yoyChange+"%"},
      {label:"İzlenen Bölge", value:selectedDistricts.length}
    ];

    stats.forEach(s=>{
      const div = document.createElement('div');
      div.className = 'glass-card p-2 text-center';
      div.innerHTML = `<strong>${s.label}</strong><p>${s.value}</p>`;
      summaryContainer.appendChild(div);
    });

    // Main Chart
    if(mainChart) mainChart.destroy();
    if(viewMode==='monthly'){
      mainChart = new Chart(mainChartCanvas,{
        type:'line',
        data:{
          labels: monthlyData.map(d=>d.month),
          datasets:selectedDistricts.map((d,index)=>({
            label:d.name,
            data:monthlyData.map(m=>m[d.name]),
            borderColor: colors[index % colors.length],
            backgroundColor: colors[index % colors.length]+'33',
            fill:true,
            tension:0.4
          }))
        },
        options:{responsive:true, plugins:{legend:{position:'bottom'}}}
      });
    } else {
      mainChart = new Chart(mainChartCanvas,{
        type:'bar',
        data:{
          labels: quarterlyData.map(d=>d.quarter),
          datasets:selectedDistricts.map((d,index)=>({
            label:d.name,
            data:quarterlyData.map(q=>q[d.name]),
            backgroundColor: colors[index % colors.length]
          }))
        },
        options:{responsive:true, plugins:{legend:{position:'bottom'}}}
      });
    }

    // Year comparison chart
    if(yearChart) yearChart.destroy();
    yearChart = new Chart(yearChartCanvas,{
      type:'bar',
      data:{
        labels: yearComparison.map(d=>d.name),
        datasets:[
          {label:"2023", data:yearComparison.map(d=>d["2023"]), backgroundColor:colors[0]},
          {label:"2024", data:yearComparison.map(d=>d["2024"]), backgroundColor:colors[1]},
          {label:"2025", data:yearComparison.map(d=>d["2025"]), backgroundColor:colors[2]}
        ]
      },
      options:{indexAxis:'y', responsive:true, plugins:{legend:{position:'bottom'}}}
    });
  }

  viewModeSelect.addEventListener('change', updateDashboard);
  yearSelect.addEventListener('change', updateDashboard);
  districtSelect.addEventListener('change', updateDashboard);

  updateDashboard();
</script>

</body>
</html>
